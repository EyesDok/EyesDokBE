{% extends 'base.html' %}
{% load static %}
{%block title %}눈똑들이다{% endblock%}
{% block link %}

        <link href="https://fonts.googleapis.com/css?family=Inter&display=swap" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href='https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css'>
        <link href="https://fonts.googleapis.com/css?family=Noto+Sans&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Kyobo+Handwriting 2022&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="{% static 'css/My.css' %}">
        <script type="text/javascript" src="{% static 'js/my_script.js' %}"></script>
{% endblock %}
{% block content %}  

        
        <div class="titlecon">
        <p class="maintitle">나의 눈똑</p>
    </div>
    
    <section class="gallery">


            <div class="center-section">
            <div class="picAndNameContainer">
              {% for post in liked_posts %}
              <a href="{% url 'noonddockApp:inform' post_id=post.id %}"></a>
                <div class="picAndName">
                  <div class="imgContainer">
                    {% if post.image %}
                    <img src="{{ post.image.url }}" alt="">
                    {% else %}
                    <img src="http://via.placeholder.com/300x300">
                    {% endif %}
                    <button class="noon-button {% if post.is_recommended %}active{% endif %}" onclick="toggleHeart(this, {{ post.id }})">
                      <span class="noon-number">{{ post.like_count }}</span>
                      <img src="{% static 'img/group 166.png' %}" class="noon-image">
                    </button>
                    <script>
                        function toggleHeart(button, postId) {
                            fetch("{% url 'noonddockApp:my_noonddock' %}", {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-CSRFToken': '{{ csrf_token }}'
                                },
                                body: JSON.stringify({ post_id: postId })
                            })
                            .then(response => response.json())
                            .then(data => {
                                if (data.is_liked) {
                                    button.classList.add('active');
                                    button.querySelector('.noon-number').textContent = data.like_count;
                                } else {
                                    button.classList.remove('active');
                                    button.querySelector('.noon-number').textContent = data.like_count;
                                }
                            });
                        }
                    </script>
                </div>
                  <p class="spot">{{ post.title }}</p>
                  <div class="buttons">
                    <a href="{% url 'noonddockApp:inform' post_id=post.id %}" class="detail-button" style="color: #000;">상세 눈똑보기</a>
                </div>
              {% endfor %}  
              </div>
            </div>
{% endblock %}    
